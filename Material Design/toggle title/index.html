<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> ActionBar跟随滚动显示 · maohhgg</title><meta name="description" content="ActionBar跟随滚动显示 - maohhgg"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://maohhgg.github.io/atom.xml" title="maohhgg"><meta name="generator" content="Hexo 4.0.0"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="/tags/" target="_self" class="nav-list-link">TAG</a></li><li class="nav-list-item"><a href="https://github.com/maohhgg" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">ActionBar跟随滚动显示</h1><div class="post-tags"><a href="/tags/Material-Design/">#Material Design</a></div><div class="post-info">2016年9月9日</div><div class="post-content"><p>隐藏ActionBar的方法有很多，可以通过代码的方式隐藏，也可以通过配置文件的方式，本片介绍简单的方式<strong>通过配置文件</strong></p>
<p>先来介绍一下<code>CoordinatorLayout</code>，他可以作为顶层布局，也可以调度协调子布局。</p>
<p><code>CoordinatorLayout</code>通过协调调度子布局的形式实现触摸影响布局的形式产生动画效果。<code>CoordinatorLayout</code>通过设置子View的 <code>app:layout_behavior</code>来调度子View。</p>
<p>在我们的项目使用<code>CoordinatorLayout</code>来同步滚动ActionBar和内容View。</p>
<p>使用<code>CoordinatorLayout</code>作为主要布局。需要关闭Theme自带的ActionBar，可以新建style建立新主题并加入</p>
<a id="more"></a>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"windowActionBar"</span>&gt;</span>false<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"windowNoTitle"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></pre></td></tr></table></figure>

<p>也可以设置Theme为<code>.NoActionBar</code>结尾的没有ActionBar的Theme</p>
<p><strong>注意</strong> Android studio 2.1 自动生成的模板中 <code>style.xml v21</code> 增加了下面两行代码</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:windowDrawsSystemBarBackgrounds"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:statusBarColor"</span>&gt;</span>@android:color/transparent<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></pre></td></tr></table></figure>

<p>在<code>CoordinatorLayout</code>标签中使用<code>android:fitsSystemWindows=&quot;true&quot;</code>，会导致ActionBar滚动到顶部是占据前端，遮挡系统状态栏。 在<code>CoordinatorLayout</code>不使用<code>android:fitsSystemWindows=&quot;true&quot;</code>又会实现<code>style.xml v21</code>中定义的条件，使得系统状态栏为白色等情况，和应用不协调。建议删除上面两行配置。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">android.support.design.widget.AppBarLayout</span></span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="tag">    <span class="attr">android:theme</span>=<span class="string">"@style/AppTheme.AppBarOverlay"</span>&gt;</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">        <span class="tag">&lt;<span class="name">android.support.v7.widget.Toolbar</span></span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">"@+id/toolbar"</span></span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"?attr/actionBarSize"</span></span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="tag">            <span class="attr">android:background</span>=<span class="string">"?attr/colorPrimary"</span></span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="tag">            <span class="attr">app:layout_scrollFlags</span>=<span class="string">"scroll|enterAlways|snap"</span></span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="tag">            <span class="attr">app:popupTheme</span>=<span class="string">"@style/AppTheme.PopupOverlay"</span> /&gt;</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="tag">&lt;/<span class="name">android.support.design.widget.AppBarLayout</span>&gt;</span></span></pre></td></tr></table></figure>

<p>通常Toolbar如上定义，<code>Toolbar</code>使用<code>AppBarLayout</code>标签包裹。</p>
<blockquote>
<p><code>AppBarLayout</code>继承自<code>LinearLayout</code>,可以认为是垂直布局的<code>LinearLayout</code>，<code>AppBarLayout</code>是在<code>LinearLayou</code>上加了一些材料设计的概念，它可以让你定制当某个可滚动View的滚动手势发生变化时，其内部的子View实现何种动作。</p>
</blockquote>
<p>在需要滚动动作的标签上定义<code>app:layout_scrollFlags</code>属性。 <code>app:layout_scrollFlags</code>属性和对应动作</p>
<ol>
<li><p>scroll 值设为scroll的View会跟随滚动事件一起发生移动。</p>
</li>
<li><p>enterAlways 值设为enterAlways的View,当ScrollView往下滚动时，该View会直接往下滚动。而不用考虑ScrollView是否在滚动。（对于滚动的绝对定位滚动）</p>
</li>
<li><p>exitUntilCollapsed 值设为exitUntilCollapsed的View，当这个View要往上逐渐”消逝”时，会一直往上滑动，直到剩下的的高度达到它的最小高度后，再响应ScrollView的内部滑动事件。</p>
</li>
<li><p>enterAlwaysCollapsed 是enterAlways的附加选项，一般跟enterAlways一起使用，它是指，View在往下”出现”的时候，首先是enterAlways效果，当View的高度达到最小高度时，View就暂时不去往下滚动，直到ScrollView滑动到顶部不再滑动时，View再继续往下滑动，直到滑到View的顶部结束。</p>
</li>
</ol>
<p>当需要在AppBarLayout中引入图片时，<code>ToolBar</code>需要使用<code>CollapsingToolbarLayout</code>标签包裹起来。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">android.support.design.widget.CollapsingToolbarLayout</span></span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">"@+id/toolbar_layout"</span></span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="tag">    <span class="attr">android:fitsSystemWindows</span>=<span class="string">"true"</span></span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="tag">    <span class="attr">app:contentScrim</span>=<span class="string">"?attr/colorPrimary"</span></span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="tag">    <span class="attr">app:expandedTitleMarginEnd</span>=<span class="string">"64dp"</span></span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="tag">    <span class="attr">app:expandedTitleMarginStart</span>=<span class="string">"48dp"</span></span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="tag">    <span class="attr">app:layout_scrollFlags</span>=<span class="string">"scroll|exitUntilCollapsed"</span>&gt;</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">ImageView</span></span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/imageView"</span></span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="tag">        <span class="attr">app:layout_collapseMode</span>=<span class="string">"parallax"</span></span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="tag">        <span class="attr">app:layout_scrollFlags</span>=<span class="string">"scroll|enterAlways|enterAlwaysCollapsed"</span></span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="tag">        <span class="attr">android:adjustViewBounds</span>=<span class="string">"true"</span>/&gt;</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">android.support.v7.widget.Toolbar</span></span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/toolbar"</span></span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"?attr/actionBarSize"</span></span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="tag">        <span class="attr">app:layout_collapseMode</span>=<span class="string">"pin"</span> /&gt;</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="tag">&lt;/<span class="name">android.support.design.widget.CollapsingToolbarLayout</span>&gt;</span></span></pre></td></tr></table></figure>

<p>向上滚动时<code>ImageView</code>高度减小，当<code>AppBarLayout</code>高度为最小时，<code>ImageView</code>隐藏，<code>AppBarLayout</code>展示的是<code>Toolbar</code>内容。所以<code>ImageView</code>标签必须在前，<code>Toolbar</code>在后。</p>
<p><code>app:layout_collapseMode=&quot;parallax&quot;</code>属性是使<code>ImageView</code>在滚动时有视差的效果，视差的不同效果可以用<code>app:layout_collapseParallaxMultiplier=&quot;0.5&quot;</code>来设置参数范围<code>0.0</code>到<code>1.0</code>，默认<code>0.5</code>。</p>
<p>当使用<code>CollapsingToolbarLayout</code>标签时，<code>Toolbar.setTitle()</code>不再有效，标题必须设置在<code>CollapsingToolbarLayout</code> View上。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">CollapsingToolbarLayout collapsingToolbar =</span></pre></td></tr><tr><td class="code"><pre><span class="line">                (CollapsingToolbarLayout) findViewById(R.id.toolbar_layout);</span></pre></td></tr><tr><td class="code"><pre><span class="line">        collapsingToolbar.setTitle(<span class="string">"title"</span>);</span></pre></td></tr></table></figure>

<p><code>AppBarLayout</code>子View不同时实现不同的动作可见<a href="https://github.com/maohhgg/AndroidStudioProjects/tree/master/Animation" target="_blank" rel="noopener">AndroidStudioProjects/Animation</a>中<a href="https://github.com/maohhgg/AndroidStudioProjects/blob/master/Animation/app/src/main/java/com/example/mao/animation/MainActivity.java" target="_blank" rel="noopener">MainActivity</a>和<a href="https://github.com/maohhgg/AndroidStudioProjects/blob/master/Animation/app/src/main/java/com/example/mao/animation/DetailActivity.java" target="_blank" rel="noopener">DetailActiviy</a>不同的滚动效果。</p>
</div></article></div></main><footer><div class="paginator"><a href="/Android%20Project%20Guidelines/3.Gradle%20Style/" class="prev">上一篇</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'maohhgg';
var disqus_identifier = 'Material Design/toggle title/';
var disqus_title = 'ActionBar跟随滚动显示';
var disqus_url = 'http://maohhgg.github.io/Material Design/toggle title/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//maohhgg.disqus.com/count.js" async></script><div class="copyright"><p>© 2015 - 2019 <a href="http://maohhgg.github.io">maohhgg</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/maohhgg/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-110078780-1",'auto');ga('send','pageview');</script></body></html>